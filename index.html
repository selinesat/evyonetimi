<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Selin & Esat Ev Y√∂netimi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .user-select {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .user-btn {
            flex: 1;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .date-display {
            text-align: center;
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .pet-section {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .pet-container {
            font-size: 80px;
            margin: 10px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .pet-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }

        .task-section {
            margin-bottom: 20px;
        }

        .task-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-title {
            font-weight: bold;
            color: #333;
            flex: 1;
        }

        .task-time {
            color: #999;
            font-size: 14px;
            margin-left: 10px;
        }

        .task-duration {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
        }

        .task-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .checkbox {
            width: 30px;
            height: 30px;
            border: 3px solid #667eea;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            transition: all 0.3s;
        }

        .checkbox.checked {
            background: #667eea;
            color: white;
        }

        .timer-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .timer-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .timer-btn.stop {
            background: #ff6b6b;
        }

        .timer-display {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin: 5px 0;
        }

        .timer-result {
            font-size: 14px;
            color: #27ae60;
            margin-top: 5px;
        }

        .message-section {
            background: #ffe5f0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .message-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ffc0cb;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .send-btn {
            width: 100%;
            padding: 10px;
            background: #ff6b9d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .messages-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .message-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .message-text {
            color: #333;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .stats-section {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .confetti {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .day-selector {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .day-btn {
            min-width: 60px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .day-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .section-title {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .task-item.completed {
            opacity: 0.6;
            background: #e8f5e9;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 10000;
            display: none;
            max-width: 90%;
        }

        .achievement-popup.show {
            display: block;
            animation: popup 0.5s;
        }

        @keyframes popup {
            from {
                transform: translate(-50%, -50%) scale(0);
            }
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .achievement-title {
            color: #667eea;
            font-size: 24px;
            margin: 10px 0;
            font-weight: bold;
        }

        .achievement-text {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Selin & Esat Ev Y√∂netimi</h1>
        </div>

        <div class="user-select">
            <button class="user-btn" id="btnEsat" onclick="selectUser('esat')">üë® ESAT</button>
            <button class="user-btn" id="btnSelin" onclick="selectUser('selin')">üë© SELƒ∞N</button>
        </div>

        <div class="date-display" id="dateDisplay"></div>

        <div class="pet-section">
            <div class="pet-container" id="petEmoji">üêï</div>
            <div style="font-weight: bold; margin: 10px 0;">K√∂peƒüiniz: <span id="petName">Buddy</span></div>
            <div class="pet-stats">
                <div class="stat">
                    <div class="stat-label">Seviye</div>
                    <div class="stat-value" id="petLevel">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Mutluluk</div>
                    <div class="stat-value" id="petHappiness">50</div>
                </div>
                <div class="stat">
                    <div class="stat-label">XP</div>
                    <div class="stat-value" id="petXP">0/100</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="xpBar" style="width: 0%"></div>
            </div>
        </div>

        <div class="day-selector" id="daySelector"></div>

        <div class="section-title" id="currentUserTitle">Bug√ºn√ºn G√∂revleri</div>
        
        <div class="task-section" id="taskSection"></div>

        <div class="stats-section">
            <div class="section-title">üìä ƒ∞statistikler</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="todayCompleted">0</div>
                    <div class="stat-text">Bug√ºn Tamamlanan</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="weekCompleted">0</div>
                    <div class="stat-text">Bu Hafta</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCompleted">0</div>
                    <div class="stat-text">Toplam</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="streak">0</div>
                    <div class="stat-text">Seri (G√ºn)</div>
                </div>
            </div>
        </div>

        <div class="message-section">
            <div class="section-title">üíå Mesajlar</div>
            <input type="text" class="message-input" id="messageInput" placeholder="E≈üine mesaj yaz...">
            <button class="send-btn" onclick="sendMessage()">G√∂nder</button>
            <div class="messages-list" id="messagesList"></div>
        </div>
    </div>

    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-emoji" id="achievementEmoji">üéâ</div>
        <h2 class="achievement-title" id="achievementTitle">Tebrikler!</h2>
        <p class="achievement-text" id="achievementText"></p>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB65JMbRij-ZkkZaQ_IkoYWpPDwclCIxHQ",
            authDomain: "selinesatevyonetimi.firebaseapp.com",
            projectId: "selinesatevyonetimi",
            storageBucket: "selinesatevyonetimi.firebasestorage.app",
            messagingSenderId: "727276404297",
            appId: "1:727276404297:web:d451a88bccd3de9fe68998",
            measurementId: "G-N51RDEN8YC",
            databaseURL: "https://selinesatevyonetimi-913cc-default-rtdb.europe-west1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.currentUser = null;
        window.currentDay = null;
        window.timers = {};

        const congratsMessages = [
            "üåü Harikasƒ±n! Bu ev i√ßin √ßok √ßalƒ±≈üƒ±yorsun!",
            "üí™ Harika bir e≈üsin! ƒ∞nan bana!",
            "‚≠ê √áok √ßalƒ±≈ükansƒ±n! Gurur duyuyorum!",
            "üíù Emeklerin √ßok deƒüerli!",
            "üéØ S√ºpersin! Devam et b√∂yle!",
            "‚ú® M√ºkemmel! Ger√ßekten harika gidiyorsun!",
            "üèÜ ≈ûampiyonsun! Ne kadar da ba≈üarƒ±lƒ±sƒ±n!",
            "üíñ Seninle gurur duyuyorum!",
            "üåà ƒ∞nanƒ±lmazsƒ±n! Tam bir yƒ±ldƒ±zsƒ±n!",
            "üéä Bravo! √áok iyi yapƒ±yorsun!",
            "üíé Sen bir hazinesin! Deƒüerini bil!",
            "üöÄ Roket gibi gidiyorsun! Muhte≈üem!",
            "üå∫ Senin gibi biri olmak ≈üanstƒ±r!",
            "‚ö° Enerjin harika! Devam et!",
            "üé® Yaratƒ±cƒ± ve √ßalƒ±≈ükan! S√ºpersin!"
        ];

        const tasks = {
            esat: {
                pzt: [
                    {id: 1, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "06:45", duration: 5, category: "sabah"},
                    {id: 2, title: "Kedimize mama ve su verelim", time: "06:50", duration: 5, category: "sabah"},
                    {id: 3, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "20:00", duration: 10, category: "aksam"},
                    {id: 4, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "20:10", duration: 5, category: "aksam"},
                    {id: 5, title: "Salonu toplayalƒ±m (koltuklar)", time: "20:15", duration: 5, category: "aksam"}
                ],
                sali: [
                    {id: 6, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "06:45", duration: 5, category: "sabah"},
                    {id: 7, title: "Kedimize mama ve su verelim", time: "06:50", duration: 5, category: "sabah"},
                    {id: 8, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "20:00", duration: 10, category: "aksam"},
                    {id: 9, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "20:10", duration: 5, category: "aksam"},
                    {id: 10, title: "Salonu 5 dakika toplayalƒ±m", time: "20:15", duration: 5, category: "aksam"}
                ],
                cars: [
                    {id: 11, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "06:45", duration: 5, category: "sabah"},
                    {id: 12, title: "Kedimize mama ve su verelim", time: "06:50", duration: 5, category: "sabah"},
                    {id: 13, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "20:00", duration: 10, category: "aksam"},
                    {id: 14, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "20:10", duration: 5, category: "aksam"},
                    {id: 15, title: "K√º√ß√ºk oda masasƒ±nƒ± toplayalƒ±m (5 e≈üya)", time: "20:15", duration: 5, category: "aksam"}
                ],
                pers: [
                    {id: 16, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "06:45", duration: 5, category: "sabah"},
                    {id: 17, title: "Kedimize mama ve su verelim", time: "06:50", duration: 5, category: "sabah"},
                    {id: 18, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "20:00", duration: 10, category: "aksam"},
                    {id: 19, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "20:10", duration: 5, category: "aksam"}
                ],
                cuma: [
                    {id: 20, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "06:45", duration: 5, category: "sabah"},
                    {id: 21, title: "Kedimize mama ve su verelim", time: "06:50", duration: 5, category: "sabah"},
                    {id: 22, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "20:00", duration: 10, category: "aksam"},
                    {id: 23, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "20:10", duration: 5, category: "aksam"},
                    {id: 24, title: "Salonu genel olarak toplayalƒ±m (10 e≈üya)", time: "20:15", duration: 15, category: "aksam"}
                ],
                ctesi: [
                    {id: 25, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "08:00", duration: 5, category: "sabah"},
                    {id: 26, title: "Kedimize mama ve su verelim", time: "08:05", duration: 5, category: "sabah"},
                    {id: 27, title: "Bula≈üƒ±k makinesini doldurup yƒ±kayalƒ±m", time: "10:00", duration: 15, category: "buyuk"},
                    {id: 28, title: "T√ºm evi toz alalƒ±m", time: "10:15", duration: 15, category: "buyuk"},
                    {id: 29, title: "T√ºm evi s√ºp√ºrelim (halƒ±lar dahil)", time: "10:30", duration: 30, category: "buyuk"},
                    {id: 30, title: "K√º√ß√ºk odayƒ± d√ºzenleyelim", time: "11:00", duration: 20, category: "buyuk"},
                    {id: 31, title: "Salon y√ºzeylerini sileyelim", time: "11:20", duration: 20, category: "buyuk"},
                    {id: 32, title: "Kapƒ± ve dolap kollarƒ±nƒ± sileyelim", time: "11:40", duration: 10, category: "buyuk"},
                    {id: 33, title: "Kedi kumunu tamamen deƒüi≈ütirelim", time: "11:50", duration: 10, category: "buyuk"},
                    {id: 34, title: "Balkonu s√ºp√ºr√ºp d√ºzenleyelim", time: "15:00", duration: 15, category: "ogle"},
                    {id: 35, title: "Elektrikli s√ºp√ºrgeyi temizleyelim", time: "15:15", duration: 15, category: "ogle"},
                    {id: 36, title: "Bah√ße i≈ülerini halledelim", time: "15:30", duration: 15, category: "ogle"}
                ],
                pazar: [
                    {id: 37, title: "√á√∂pleri dƒ±≈üarƒ± √ßƒ±karalƒ±m", time: "09:00", duration: 5, category: "sabah"},
                    {id: 38, title: "Kedimize mama ve su verelim", time: "09:05", duration: 5, category: "sabah"},
                    {id: 39, title: "Bula≈üƒ±k makinesini dolduralƒ±m", time: "19:30", duration: 10, category: "aksam"},
                    {id: 40, title: "B√ºy√ºk bula≈üƒ±klarƒ± el ile yƒ±kayalƒ±m", time: "19:40", duration: 5, category: "aksam"}
                ]
            },
            selin: {
                pzt: [
                    {id: 101, title: "Yemek hazƒ±rlayalƒ±m", time: "17:00", duration: 15, category: "aksam"},
                    {id: 102, title: "Yatak odasƒ±ndaki kƒ±yafetleri ayƒ±ralƒ±m", time: "17:15", duration: 10, category: "aksam"},
                    {id: 103, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                sali: [
                    {id: 104, title: "√áama≈üƒ±r makinesini ba≈ülatalƒ±m", time: "06:30", duration: 10, category: "sabah"},
                    {id: 105, title: "Yemek hazƒ±rlayalƒ±m", time: "16:45", duration: 15, category: "aksam"},
                    {id: 106, title: "√áama≈üƒ±rlarƒ± asalƒ±m", time: "17:00", duration: 10, category: "aksam"},
                    {id: 107, title: "Mutfak tezgahƒ±nƒ± sileyelim", time: "17:10", duration: 5, category: "aksam"},
                    {id: 108, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                cars: [
                    {id: 109, title: "Yemek hazƒ±rlayalƒ±m", time: "17:00", duration: 15, category: "aksam"},
                    {id: 110, title: "Kƒ±yafetleri √ºt√ºleyelim (3-4 par√ßa)", time: "17:15", duration: 15, category: "aksam"},
                    {id: 111, title: "Banyo lavabo ve aynayƒ± sileyelim", time: "17:30", duration: 10, category: "aksam"},
                    {id: 112, title: "Mutfak lavabosunu sileyelim", time: "17:40", duration: 5, category: "aksam"},
                    {id: 113, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                pers: [
                    {id: 114, title: "√áama≈üƒ±r makinesini ba≈ülatalƒ±m", time: "06:30", duration: 10, category: "sabah"},
                    {id: 115, title: "Hƒ±zlƒ± bir yemek hazƒ±rlayalƒ±m", time: "16:45", duration: 15, category: "aksam"},
                    {id: 116, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                cuma: [
                    {id: 117, title: "Yemek hazƒ±rlayalƒ±m", time: "17:00", duration: 15, category: "aksam"},
                    {id: 118, title: "√áama≈üƒ±rlarƒ± dolaba yerle≈ütirelim", time: "17:15", duration: 15, category: "aksam"},
                    {id: 119, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                ctesi: [
                    {id: 120, title: "√áama≈üƒ±r yƒ±kayƒ±p asalƒ±m", time: "10:00", duration: 20, category: "buyuk"},
                    {id: 121, title: "Yatak odasƒ±nƒ± d√ºzenleyelim", time: "10:20", duration: 30, category: "buyuk"},
                    {id: 122, title: "√út√º yapalƒ±m (10 par√ßa)", time: "10:50", duration: 20, category: "buyuk"},
                    {id: 123, title: "Banyoyu temizleyelim", time: "11:10", duration: 30, category: "buyuk"},
                    {id: 124, title: "T√ºm evin yerlerini sileyelim", time: "11:40", duration: 20, category: "buyuk"},
                    {id: 125, title: "Buzdolabƒ±nƒ± temizleyelim", time: "15:00", duration: 15, category: "ogle"},
                    {id: 126, title: "Mutfak ve ocaƒüƒ± derinlemesine temizleyelim", time: "15:15", duration: 15, category: "ogle"},
                    {id: 127, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ],
                pazar: [
                    {id: 128, title: "Yemek hazƒ±rlayalƒ±m", time: "18:00", duration: 20, category: "aksam"},
                    {id: 129, title: "Bula≈üƒ±k makinesini bo≈üaltalƒ±m", time: "21:00", duration: 10, category: "aksam"}
                ]
            }
        };

        const dayNames = ['pazar', 'pazartesi', 'sali', 'carsamba', 'persembe', 'cuma', 'cumartesi'];
        const dayNamesDisplay = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];

        function getMonday(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }

        function isNewWeek(lastDate, currentDate) {
            const lastMonday = getMonday(lastDate);
            const currentMonday = getMonday(currentDate);
            lastMonday.setHours(0, 0, 0, 0);
            currentMonday.setHours(0, 0, 0, 0);
            return lastMonday.getTime() !== currentMonday.getTime();
        }

        function checkWeeklyReset() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            get(ref(database, 'lastReset')).then((snapshot) => {
                const lastReset = snapshot.val();
                const lastResetDate = lastReset ? new Date(lastReset) : null;
                
                if (dayOfWeek === 1 && (!lastResetDate || isNewWeek(lastResetDate, today))) {
                    resetWeeklyTasks();
                    set(ref(database, 'lastReset'), today.toISOString());
                }
            });
        }

        function resetWeeklyTasks() {
            set(ref(database, 'taskData/timers'), {});
            
            get(ref(database, 'stats')).then((snapshot) => {
                const stats = snapshot.val() || {};
                stats.todayCompleted = 0;
                stats.weekCompleted = 0;
                set(ref(database, 'stats'), stats);
            });
            
            showAchievement('üåÖ Yeni Hafta!', 'Hadi ba≈ütan ba≈ülayalƒ±m! Yeni bir hafta, yeni bir ba≈ülangƒ±√ß! K√∂peƒüiniz ve seviyeniz korunuyor! üí™');
        }

        function checkAllTasksCompleted() {
            if (!window.currentUser || !window.currentDay) return;
            
            const userTasks = tasks[window.currentUser][window.currentDay] || [];
            if (userTasks.length === 0) return;
            
            let allCompleted = true;
            userTasks.forEach(task => {
                const taskTimerId = `${window.currentUser}-${window.currentDay}-${task.id}`;
                if (!window.timers[taskTimerId] || !window.timers[taskTimerId].completed) {
                    allCompleted = false;
                }
            });
            
            if (allCompleted) {
                showRelaxMessage();
            }
        }

        function showRelaxMessage() {
            const messages = [
                "Tebrikler! Bug√ºn√ºn t√ºm g√∂revlerini tamamladƒ±n!",
                "Artƒ±k dinlenme zamanƒ±! ƒ∞yi √ßalƒ±≈ütƒ±n!",
                "Hepsini bitirdin! ≈ûimdi kendine zaman ayƒ±r!",
                "Muhte≈üem! Artƒ±k rahat edebilirsin!",
                "Bug√ºn √ßok √ºretkendin! Kendini √∂d√ºllendir!",
                "Harika bir g√ºnd√º! Artƒ±k dinlenebilirsin!"
            ];
            
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            
            showAchievement('üèñÔ∏è Hadi Dinlen!', randomMsg, 'üòå');
            
            createBigConfetti();
        }

        function init() {
            const today = new Date().getDay();
            window.currentDay = dayNames[today];
            updateDateDisplay();
            createDaySelector();
            loadPetData();
            loadStats();
            loadMessages();
            checkWeeklyReset();
            
            setInterval(checkWeeklyReset, 60 * 60 * 1000);
        }

        function updateDateDisplay() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = today.toLocaleDateString('tr-TR', options);
        }

        function createDaySelector() {
            const selector = document.getElementById('daySelector');
            selector.innerHTML = '';
            dayNamesDisplay.forEach((name, index) => {
                const btn = document.createElement('button');
                btn.className = 'day-btn';
                btn.textContent = name;
                btn.onclick = () => selectDay(dayNames[index]);
                if (dayNames[index] === window.currentDay) {
                    btn.classList.add('active');
                }
                selector.appendChild(btn);
            });
        }

        window.selectUser = function(user) {
            window.currentUser = user;
            document.getElementById('btnEsat').classList.remove('active');
            document.getElementById('btnSelin').classList.remove('active');
            document.getElementById(user === 'esat' ? 'btnEsat' : 'btnSelin').classList.add('active');
            document.getElementById('currentUserTitle').textContent = 
                (user === 'esat' ? 'üë® Esat' : 'üë© Selin') + ' - Bug√ºn√ºn G√∂revleri';
            renderTasks();
        };

        window.selectDay = function(day) {
            window.currentDay = day;
            document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderTasks();
        };

        function renderTasks() {
            if (!window.currentUser || !window.currentDay) return;
            
            const taskSection = document.getElementById('taskSection');
            const userTasks = tasks[window.currentUser][window.currentDay] || [];
            
            taskSection.innerHTML = '';
            
            userTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-item';
                taskDiv.id = `task-${task.id}`;
                
                const timerId = `${window.currentUser}-${window.currentDay}-${task.id}`;
                const timerData = window.timers[timerId] || {};
                
                taskDiv.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <span class="task-duration">${task.duration} dk</span>
                        <div class="task-time">${task.time}</div>
                    </div>
                    <div class="task-controls">
                        <div class="checkbox ${timerData.completed ? 'checked' : ''}" id="check-${task.id}" onclick="toggleTask(${task.id})">
                            ${timerData.completed ? '‚úì' : ''}
                        </div>
                        <button class="timer-btn" id="timer-btn-${task.id}" 
                            onclick="${timerData.running ? `stopTimer(${task.id}, ${task.duration})` : `startTimer(${task.id})`}">
                            ${timerData.running ? '‚èπ Bitir' : '‚ñ∂Ô∏è Ba≈üla'}
                        </button>
                    </div>
                    ${timerData.running ? `<div class="timer-display" id="timer-${task.id}">00:00</div>` : ''}
                    ${timerData.result ? `<div class="timer-result">${timerData.result}</div>` : ''}
                `;
                
                if (timerData.completed) {
                    taskDiv.classList.add('completed');
                }
                
                taskSection.appendChild(taskDiv);
            });
        }

        window.startTimer = function(taskId) {
            const timerId = `${window.currentUser}-${window.currentDay}-${taskId}`;
            const startTime = Date.now();
            
            window.timers[timerId] = {
                startTime: startTime,
                running: true,
                interval: null
            };
            
            const timerDisplay = document.createElement('div');
            timerDisplay.className = 'timer-display';
            timerDisplay.id = `timer-${taskId}`;
            document.getElementById(`task-${taskId}`).insertBefore(
                timerDisplay,
                document.getElementById(`timer-btn-${taskId}`).parentElement
            );
            
            window.timers[timerId].interval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById(`timer-${taskId}`).textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
            
            renderTasks();
        };

        window.stopTimer = function(taskId, expectedDuration) {
            const timerId = `${window.currentUser}-${window.currentDay}-${taskId}`;
            const timerData = window.timers[timerId];
            
            if (!timerData) return;
            
            clearInterval(timerData.interval);
            const elapsed = Math.floor((Date.now() - timerData.startTime) / 1000 / 60);
            const diff = expectedDuration - elapsed;
            
            let result = '';
            if (diff > 0) {
                result = `üéâ ${diff} DK HIZLISIN!`;
            } else if (diff < 0) {
                result = `‚è±Ô∏è ${Math.abs(diff)} dk fazla s√ºrd√º`;
            } else {
                result = `‚ú® Tam zamanƒ±nda!`;
            }
            
            window.timers[timerId] = {
                completed: true,
                running: false,
                result: result,
                actualTime: elapsed
            };
            
            addXP(10);
            updateStats('complete');
            saveToFirebase();
            createConfetti();
            
            const randomCongrats = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
            showAchievement('üéâ Tebrikler!', randomCongrats);
            
            setTimeout(checkAllTasksCompleted, 1000);
            renderTasks();
        };

        window.toggleTask = function(taskId) {
            const timerId = `${window.currentUser}-${window.currentDay}-${taskId}`;
            
            if (!window.timers[timerId]) {
                window.timers[timerId] = {};
            }
            
            window.timers[timerId].completed = !window.timers[timerId].completed;
            
            if (window.timers[timerId].completed) {
                addXP(5);
                updateStats('complete');
                createConfetti();
                
                const randomCongrats = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
                showAchievement('üéâ Tebrikler!', randomCongrats);
                
                setTimeout(checkAllTasksCompleted, 1000);
            } else {
                updateStats('uncomplete');
            }
            
            saveToFirebase();
            renderTasks();
        };

        function addXP(amount) {
            get(ref(database, 'pet')).then((snapshot) => {
                const petData = snapshot.val() || { level: 1, xp: 0, happiness: 50 };
                petData.xp += amount;
                petData.happiness = Math.min(100, petData.happiness + 2);
                
                const xpNeeded = petData.level * 100;
                if (petData.xp >= xpNeeded) {
                    petData.level++;
                    petData.xp = petData.xp - xpNeeded;
                    showAchievement('üéä Seviye Atladƒ±!', `K√∂peƒüiniz Seviye ${petData.level} oldu! Tebrikler!`, 'üêï');
                    createBigConfetti();
                }
                
                set(ref(database, 'pet'), petData);
                updatePetDisplay(petData);
            });
        }

        function updatePetDisplay(petData) {
            document.getElementById('petLevel').textContent = petData.level;
            document.getElementById('petHappiness').textContent = petData.happiness;
            const xpNeeded = petData.level * 100;
            document.getElementById('petXP').textContent = `${petData.xp}/${xpNeeded}`;
            document.getElementById('xpBar').style.width = `${(petData.xp / xpNeeded) * 100}%`;
            
            const emojis = ['üêï', 'üêï‚Äçü¶∫', 'üê©', 'üêï‚Äçü¶∫', 'üê∫'];
            document.getElementById('petEmoji').textContent = emojis[Math.min(petData.level - 1, 4)];
        }

        function loadPetData() {
            onValue(ref(database, 'pet'), (snapshot) => {
                const petData = snapshot.val() || { level: 1, xp: 0, happiness: 50 };
                updatePetDisplay(petData);
            });
        }

        function updateStats(action) {
            get(ref(database, 'stats')).then((snapshot) => {
                const stats = snapshot.val() || {
                    todayCompleted: 0,
                    weekCompleted: 0,
                    totalCompleted: 0,
                    streak: 0
                };
                
                if (action === 'complete') {
                    stats.todayCompleted++;
                    stats.weekCompleted++;
                    stats.totalCompleted++;
                } else if (action === 'uncomplete') {
                    stats.todayCompleted = Math.max(0, stats.todayCompleted - 1);
                    stats.weekCompleted = Math.max(0, stats.weekCompleted - 1);
                    stats.totalCompleted = Math.max(0, stats.totalCompleted - 1);
                }
                
                set(ref(database, 'stats'), stats);
                displayStats(stats);
            });
        }

        function displayStats(stats) {
            document.getElementById('todayCompleted').textContent = stats.todayCompleted || 0;
            document.getElementById('weekCompleted').textContent = stats.weekCompleted || 0;
            document.getElementById('totalCompleted').textContent = stats.totalCompleted || 0;
            document.getElementById('streak').textContent = stats.streak || 0;
        }

        function loadStats() {
            onValue(ref(database, 'stats'), (snapshot) => {
                const stats = snapshot.val() || {
                    todayCompleted: 0,
                    weekCompleted: 0,
                    totalCompleted: 0,
                    streak: 0
                };
                displayStats(stats);
            });
        }

        window.sendMessage = function() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !window.currentUser) return;
            
            const messageRef = push(ref(database, 'messages'));
            set(messageRef, {
                sender: window.currentUser,
                text: text,
                timestamp: Date.now()
            });
            
            input.value = '';
        };

        function loadMessages() {
            onValue(ref(database, 'messages'), (snapshot) => {
                const messages = [];
                snapshot.forEach((child) => {
                    messages.push({ id: child.key, ...child.val() });
                });
                
                messages.sort((a, b) => b.timestamp - a.timestamp);
                
                const messagesList = document.getElementById('messagesList');
                messagesList.innerHTML = '';
                
                messages.slice(0, 10).forEach(msg => {
                    const msgDiv = document.createElement('div');
                    msgDiv.className = 'message-item';
                    const date = new Date(msg.timestamp);
                    msgDiv.innerHTML = `
                        <div class="message-sender">${msg.sender === 'esat' ? 'üë® Esat' : 'üë© Selin'}</div>
                        <div class="message-text">${msg.text}</div>
                        <div class="message-time">${date.toLocaleString('tr-TR')}</div>
                    `;
                    messagesList.appendChild(msgDiv);
                });
            });
        }

        function saveToFirebase() {
            const dataToSave = {
                timers: window.timers,
                lastUpdate: Date.now()
            };
            set(ref(database, 'taskData'), dataToSave);
        }

        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.background = ['#667eea', '#764ba2', '#ffeaa7', '#fdcb6e', '#ff6b9d', '#00b894', '#e17055'][Math.floor(Math.random() * 7)];
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 15);
            }
        }

        function createBigConfetti() {
            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.width = (Math.random() * 15 + 8) + 'px';
                    confetti.style.height = (Math.random() * 15 + 8) + 'px';
                    confetti.style.background = ['#667eea', '#764ba2', '#ffeaa7', '#fdcb6e', '#ff6b9d', '#00b894', '#e17055', '#6c5ce7', '#a29bfe'][Math.floor(Math.random() * 9)];
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 10);
            }
        }

        function showAchievement(title, text, emoji = 'üéâ') {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementEmoji').textContent = emoji;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementText').textContent = text;
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 4000);
        }

        get(ref(database, 'taskData')).then((snapshot) => {
            if (snapshot.exists()) {
                window.timers = snapshot.val().timers || {};
            }
            renderTasks();
        });

        init();
    </script>
</body>
</html>
